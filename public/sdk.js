/*! For license information please see sdk.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.HelperWidget=e():t.HelperWidget=e()}(this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(){i=function(){return e};var t,e={},o=Object.prototype,r=o.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof b?e:b,r=Object.create(o.prototype),s=new _(i||[]);return a(r,"_invoke",{value:I(t,n,s)}),r}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",g="suspendedYield",m="executing",v="completed",y={};function b(){}function w(){}function x(){}var k={};h(k,l,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(B([])));L&&L!==o&&r.call(L,l)&&(k=L);var T=x.prototype=b.prototype=Object.create(k);function S(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function i(o,a,s,l){var c=f(t[o],t,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==n(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){i("next",t,s,l)}),(function(t){i("throw",t,s,l)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return i("throw",t,s,l)}))}l(c.arg)}var o;a(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}})}function I(e,n,i){var o=p;return function(r,a){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===r)throw a;return{value:t,done:!0}}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var l=O(s,i);if(l){if(l===y)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===p)throw o=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=m;var c=f(e,n,i);if("normal"===c.type){if(o=i.done?v:g,c.arg===y)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=v,i.method="throw",i.arg=c.arg)}}}function O(e,n){var i=n.method,o=e.iterator[i];if(o===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),y;var r=f(o,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;var a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function B(e){if(e||""===e){var i=e[l];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=x,a(T,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(C.prototype),h(C.prototype,c,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,i,o,r){void 0===r&&(r=Promise);var a=new C(d(t,n,i,o),r);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(T),h(T,u,"Generator"),h(T,l,(function(){return this})),h(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=B,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(i,o){return s.type="throw",s.arg=e,n.next=i,o&&(n.method="next",n.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;A(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:B(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),y}},e}function o(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if(t){if("string"==typeof t)return a(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function s(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){s(r,i,o,a,l,"next",t)}function l(t){s(r,i,o,a,l,"throw",t)}a(void 0)}))}}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,h(i.key),i)}}function u(t,e,n){return(e=h(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}t.d(e,{default:()=>p});var d="gumroad",f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,"iframe",null),u(this,"iframeWrapper",null),u(this,"helperIcon",null),u(this,"overlay",null),u(this,"loadingOverlay",null),u(this,"notificationContainer",null),u(this,"notificationBubbles",new Map),u(this,"isVisible",!1),u(this,"isIframeReady",!1),u(this,"toggleButton",null),u(this,"hasBeenOpened",!1),u(this,"sessionToken",null),u(this,"showWidget",!1),u(this,"messageQueue",[]),u(this,"observer",null),u(this,"messageType","HELPER_WIDGET_MESSAGE"),u(this,"VISIBILITY_STORAGE_KEY","helper_widget_visible"),u(this,"CONVERSATION_STORAGE_KEY","helper_widget_conversation"),u(this,"currentConversationSlug",null),this.config=e}return e=t,n=[{key:"setup",value:function(){this.injectStyles(),this.createOverlay(),this.createLoadingOverlay(),this.createWrapper(),this.createToggleButton(),this.createNotificationContainer(),this.setupEventListeners(),this.createSession();var t="true"===localStorage.getItem(this.VISIBILITY_STORAGE_KEY);t&&this.showInternal();var e=localStorage.getItem(this.CONVERSATION_STORAGE_KEY);e&&t&&(this.currentConversationSlug=e)}},{key:"createSession",value:(h=l(i().mark((function t(){var e,n,r,a=this;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.validateConfig()){t.next=3;break}return console.error("Invalid config, missing required fields",this.config),t.abrupt("return");case 3:return t.prev=3,t.next=6,fetch("".concat(new URL("https://helper.ai/widget/embed").origin,"/api/widget/session"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.config.email,emailHash:this.config.email_hash,mailboxSlug:this.config.mailbox_slug,timestamp:this.config.timestamp,customerMetadata:this.config.customer_metadata})});case 6:if((e=t.sent).ok){t.next=10;break}return console.error("Session creation failed"),t.abrupt("return");case 10:return t.next=12,e.json();case 12:(n=t.sent).token&&(this.sessionToken=n.token,this.setShowWidget(n.showWidget),(null===(r=n.notifications)||void 0===r?void 0:r.length)>0&&setTimeout((function(){o(n.notifications).reverse().forEach((function(t,e){setTimeout((function(){a.showNotification(t.text,t.conversationSlug,t.id)}),800*e)}))}),2e3)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(3),console.error("Failed to create Helper session:",t.t0);case 19:case"end":return t.stop()}}),t,this,[[3,16]])}))),function(){return h.apply(this,arguments)})},{key:"setShowWidget",value:function(t){this.showWidget=t,t?(this.addHelperIcon(),this.notificationContainer&&this.notificationContainer.classList.add("with-widget")):this.notificationContainer&&this.notificationContainer.classList.remove("with-widget")}},{key:"validateConfig",value:function(){return!!(this.config.email&&this.config.email_hash&&this.config.mailbox_slug&&this.config.timestamp)||(console.error("Invalid config, missing required fields",this.config),!1)}},{key:"createWrapper",value:function(){this.iframeWrapper||(this.iframeWrapper=document.createElement("div"),this.iframeWrapper.className="helper-widget-wrapper",this.loadingOverlay&&this.iframeWrapper.appendChild(this.loadingOverlay),document.body.appendChild(this.iframeWrapper))}},{key:"injectStyles",value:function(){var t=document.createElement("style");t.textContent='.helper-widget-wrapper {\n  position: fixed;\n  right: -100%;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  background-color: white;\n  transition: right 0.3s ease-in-out;\n  z-index: 10000;\n  overflow: hidden;\n}\n\n.helper-widget-wrapper iframe {\n  width: 100%;\n  height: 100%;\n  border: none;\n}\n\n.helper-widget-wrapper.visible {\n  right: 0;\n}\n\n@keyframes helper-widget-fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n.helper-widget-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.1);\n  z-index: 9990;\n  opacity: 0;\n  visibility: hidden;\n  transition:\n    opacity 0.3s ease-in-out,\n    visibility 0.3s ease-in-out;\n}\n\n.helper-widget-overlay.visible {\n  opacity: 1;\n  visibility: visible;\n  animation: helper-widget-fade-in 0.3s ease-in-out;\n}\n\n.helper-widget-loading-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(255, 255, 255, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 9999;\n  opacity: 0;\n  visibility: hidden;\n  transition:\n    opacity 0.3s ease,\n    visibility 0.3s ease;\n}\n\n.helper-widget-loading-overlay.visible {\n  opacity: 1;\n  visibility: visible;\n}\n\n.helper-widget-spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid #f3f3f3;\n  border-top: 3px solid #333;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n@media (min-width: 640px) {\n  .helper-widget-wrapper {\n    width: 520px;\n    right: -520px;\n    border-left: 1px solid black;\n  }\n}\n\n@keyframes slide-bounce-in {\n  0% {\n    transform: translateX(100%);\n  }\n  60% {\n    transform: translateX(-10%);\n  }\n  80% {\n    transform: translateX(5%);\n  }\n  100% {\n    transform: translateX(0);\n  }\n}\n\n.helper-widget-toggle-button {\n  position: fixed;\n  right: 0px;\n  top: 100px;\n  width: 40px;\n  height: 40px;\n  border-radius: 8px 0px 0px 8px;\n  background-color: #fff;\n  color: black;\n  border-width: 1px 0px 1px 1px;\n  border-style: solid;\n  border-color: black;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 16px;\n  z-index: 9995;\n  opacity: 0;\n  visibility: hidden;\n  transition:\n    transform 0.3s ease,\n    background-color 0.3s ease,\n    color 0.3s ease;\n}\n\n.helper-widget-toggle-button.visible {\n  opacity: 1;\n  visibility: visible;\n  animation: slide-bounce-in 0.5s ease-out forwards;\n}\n\n.helper-widget-toggle-button.gumroad-theme {\n  background-color: #f4f4ef;\n  color: #000000;\n  font-family: "Mabry Pro", sans-serif;\n  font-weight: 500;\n  box-shadow: -2px 2px 0 0 #000000;\n  transition:\n    transform 0.3s ease,\n    background-color 0.3s ease,\n    color 0.3s ease,\n    box-shadow 0.3s ease;\n}\n\n.helper-widget-toggle-button:hover {\n  background-color: #000000;\n  color: #ffffff;\n}\n\n.helper-widget-toggle-button.gumroad-theme:hover {\n  background-color: #ff7ad9;\n  color: #000;\n  box-shadow: -3px 3px 0 0 #000000;\n}\n\n.helper-widget-icon {\n  border-radius: 50%;\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  background-color: #222;\n  color: white;\n  display: flex;\n  width: 60px;\n  height: 60px;\n  cursor: pointer;\n  transition: filter 0.3s;\n  align-items: center;\n  justify-content: center;\n}\n\n.helper-widget-icon:hover {\n  filter: brightness(1.1);\n}\n\n.helper-widget-icon .hand-icon {\n  width: 26px;\n  height: 29px;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  transform-origin: bottom center;\n}\n\n.helper-widget-icon:hover .hand-icon {\n  animation: subtleWave 1s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;\n}\n\n.helper-widget-icon.has-notification .hand-icon {\n  animation: subtleWave 1s cubic-bezier(0.25, 0.1, 0.25, 1) 2;\n}\n\n@keyframes subtleWave {\n  0% {\n    transform: translate(-50%, -50%) rotate(0deg);\n  }\n  20% {\n    transform: translate(-50%, -50%) rotate(-10deg);\n  }\n  40% {\n    transform: translate(-50%, -50%) rotate(8deg);\n  }\n  60% {\n    transform: translate(-50%, -50%) rotate(-4deg);\n  }\n  80% {\n    transform: translate(-50%, -50%) rotate(2deg);\n  }\n  100% {\n    transform: translate(-50%, -50%) rotate(0deg);\n  }\n}\n\n.notification-container {\n  position: fixed;\n  right: 20px;\n  bottom: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  z-index: 9999;\n  pointer-events: none;\n  width: 320px;\n}\n\n.notification-container.with-widget {\n  bottom: 100px;\n}\n\n@media (max-width: 639px) {\n  .notification-container {\n    right: 16px;\n    bottom: 16px;\n    width: calc(100% - 32px);\n  }\n\n  .notification-container.with-widget {\n    bottom: 96px;\n  }\n}\n\n@keyframes slide-in {\n  0% {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes slide-out {\n  0% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n  100% {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n}\n\n.notification-bubble {\n  background-color: white;\n  border: 1px solid black;\n  border-radius: 8px;\n  padding: 12px 40px 12px 16px;\n  position: relative;\n  cursor: pointer;\n  pointer-events: auto;\n  opacity: 0;\n  transform: translateY(20px);\n  transition: background-color 0.2s ease;\n}\n\n.notification-bubble.visible {\n  animation: slide-in 0.3s ease forwards;\n}\n\n.notification-bubble.hiding {\n  animation: slide-out 0.3s ease forwards;\n}\n\n.notification-bubble .message {\n  flex: 1;\n  font-size: 16px;\n  line-height: 1.4;\n  cursor: pointer;\n  color: #000000;\n  font-weight: 450;\n  padding-right: 8px;\n}\n\n.notification-bubble .close-button {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  width: 24px;\n  height: 24px;\n  padding: 0;\n  border: none;\n  border-radius: 50%;\n  background: #6b7280;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition:\n    opacity 0.2s ease,\n    background-color 0.2s ease;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n\n.notification-bubble .close-button svg {\n  width: 10px;\n  height: 10px;\n  stroke-width: 2.5;\n}\n\n.notification-bubble:hover .close-button {\n  opacity: 1;\n}\n\n.notification-bubble .close-button:hover {\n  background: #4b5563;\n}\n\n.notification-bubble.gumroad-theme {\n  background-color: #f4f4ef;\n  box-shadow: -2px 2px 0 0 #000000;\n  font-family: "Mabry Pro", sans-serif;\n}\n\n.notification-bubble.gumroad-theme .close-button {\n  background: #000000;\n}\n\n.notification-bubble.gumroad-theme .close-button:hover {\n  background: #ff7ad9;\n}\n\n@media (max-width: 639px) {\n  .notification-container {\n    right: 16px;\n    bottom: 16px;\n    width: calc(100% - 32px);\n  }\n\n  .notification-bubble {\n    padding: 14px 18px;\n  }\n\n  .notification-bubble .close-button {\n    opacity: 1;\n  }\n}\n\n.helper-widget-icon + .notification-container {\n  bottom: 100px;\n}\n\n@media (max-width: 639px) {\n  .notification-container {\n    right: 16px;\n    bottom: 16px;\n    width: calc(100% - 32px);\n  }\n\n  .helper-widget-icon + .notification-container {\n    bottom: 96px;\n  }\n}\n',document.head.appendChild(t)}},{key:"createLoadingOverlay",value:function(){this.loadingOverlay=document.createElement("div"),this.loadingOverlay.className="helper-widget-loading-overlay",this.loadingOverlay.innerHTML='<div class="helper-widget-spinner"></div>'}},{key:"addHelperIcon",value:function(){if(!this.helperIcon){this.helperIcon=document.createElement("button"),this.helperIcon.className="helper-widget-icon";var t=this.config.icon_color||"#222",e=this.isLightColor(t)?"#000000":"#FFFFFF";this.helperIcon.innerHTML='<svg class="hand-icon" width="26" height="29" viewBox="0 0 26 29" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.9885 19.1603C14.4462 16.4526 25.36 8.80865 25.36 8.80865L22.5717 4.78239C22.5717 4.78239 18.2979 8.46521 15.1353 12.7541C14.4648 13.7215 13.1488 12.9234 13.9447 11.5515C15.9064 8.16995 21.5892 2.70127 21.5892 2.70127L17.2712 0.54569C17.2712 0.54569 14.458 3.38303 10.9133 10.5004C10.2651 11.8018 8.94659 11.1429 9.39493 9.80167C10.5422 6.36947 14.2637 0.913031 14.2637 0.913031L9.74091 0.17627C9.74091 0.17627 7.30141 4.59585 5.78539 10.0891C5.46118 11.2634 4.04931 10.9838 4.2171 9.81717C4.50759 7.79708 6.51921 1.95354 6.51921 1.95354L2.60762 1.97033C2.60762 1.97033 -0.737277 9.78607 1.7329 18.4073C3.13956 23.3167 7.54191 28.1763 13.287 28.1763C18.9209 28.1763 23.8513 23.8362 25.5294 17.1416L21.6221 14.1778C21.6221 14.1778 19.4441 21.7758 16.9885 19.1603Z" fill="'.concat(e,'"/></svg>'),this.helperIcon.style.backgroundColor=t,document.body.appendChild(this.helperIcon),this.connectToggleElement(this.helperIcon)}}},{key:"isLightColor",value:function(t){var e=t.replace("#","");return(.299*parseInt(e.substr(0,2),16)+.587*parseInt(e.substr(2,2),16)+.114*parseInt(e.substr(4,2),16))/255>.5}},{key:"createIframe",value:function(){this.iframe||(this.iframe=document.createElement("iframe"),this.iframe.className="helper-widget-iframe",this.iframe.src="https://helper.ai/widget/embed",this.iframeWrapper&&this.iframeWrapper.appendChild(this.iframe),this.showLoadingOverlay())}},{key:"showLoadingOverlay",value:function(){this.loadingOverlay&&this.loadingOverlay.classList.add("visible")}},{key:"hideLoadingOverlay",value:function(){this.loadingOverlay&&this.loadingOverlay.classList.remove("visible")}},{key:"createOverlay",value:function(){this.overlay=document.createElement("div"),this.overlay.className="helper-widget-overlay",document.body.appendChild(this.overlay)}},{key:"setupEventListeners",value:function(){var e,n=this;this.connectExistingPromptElements(),this.connectExistingToggleElements(),this.setupMutationObserver(),null===(e=this.overlay)||void 0===e||e.addEventListener("click",(function(){return t.hide()})),window.addEventListener("message",(function(e){var i=new URL("https://helper.ai/widget/embed").origin;if(e.origin===i&&e.data&&e.data.type===n.messageType){var o=e.data.payload,r=o.action,a=o.content;switch(r){case"CLOSE":t.hide();break;case"READY":n.onIframeReady();break;case"CONVERSATION_UPDATE":n.currentConversationSlug=a.conversationSlug,localStorage.setItem(n.CONVERSATION_STORAGE_KEY,a.conversationSlug||"")}}}))}},{key:"onIframeReady",value:function(){this.isIframeReady||(this.isIframeReady=!0,this.hideLoadingOverlay(),this.initFrameConfig(),this.processMessageQueue(),this.currentConversationSlug&&this.sendMessageToEmbed({action:"OPEN_CONVERSATION",content:{conversationSlug:this.currentConversationSlug}}))}},{key:"initFrameConfig",value:function(){this.sendMessageToEmbed({action:"CONFIG",content:{config:this.config,sessionToken:this.sessionToken}})}},{key:"connectExistingPromptElements",value:function(){document.querySelectorAll("[data-helper-prompt]").forEach(this.connectPromptElement.bind(this))}},{key:"connectPromptElement",value:function(t){var e=this;t.addEventListener("click",(function(t){return e.handlePromptClick(t)}))}},{key:"handlePromptClick",value:function(e){var n=e.currentTarget,i=n.getAttribute("data-helper-prompt");i&&(this.sendPromptToEmbed(i),n.setAttribute("data-helper-prompt-sent","true")),t.show()}},{key:"connectExistingToggleElements",value:function(){document.querySelectorAll("[data-helper-toggle]").forEach(this.connectToggleElement.bind(this))}},{key:"connectToggleElement",value:function(t){var e=this;t.addEventListener("click",(function(t){return e.handleToggleClick(t)}))}},{key:"handleToggleClick",value:function(e){var n=e.currentTarget;t.toggle(),this.updateToggleState(n)}},{key:"updateToggleState",value:function(t){var e=this.isVisible?"true":"false";t.setAttribute("data-helper-open",e)}},{key:"setupMutationObserver",value:function(){var t=this;this.observer=new MutationObserver((function(e){var n,i=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=r(t))){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(s)throw o}}}}(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;"childList"===o.type&&o.addedNodes.forEach((function(e){e instanceof HTMLElement&&(e.hasAttribute("data-helper-prompt")&&t.connectPromptElement(e),e.hasAttribute("data-helper-toggle")&&t.connectToggleElement(e),e.querySelectorAll("[data-helper-prompt]").forEach(t.connectPromptElement.bind(t)),e.querySelectorAll("[data-helper-toggle]").forEach(t.connectToggleElement.bind(t)))}))}}catch(t){i.e(t)}finally{i.f()}})),this.observer.observe(document.body,{childList:!0,subtree:!0})}},{key:"createToggleButton",value:function(){this.toggleButton||(this.toggleButton=document.createElement("button"),this.toggleButton.className="helper-widget-toggle-button",this.config.mailbox_slug===d&&this.toggleButton.classList.add("gumroad-theme"),this.toggleButton.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" />\n</svg>\n\n    ',this.toggleButton.addEventListener("click",(function(){return t.show()})))}},{key:"sendMessageToEmbed",value:function(t){var e;this.isIframeReady&&null!==(e=this.iframe)&&void 0!==e&&e.contentWindow?this.iframe.contentWindow.postMessage({type:this.messageType,payload:t},new URL("https://helper.ai/widget/embed").origin):(this.messageQueue.push(t),this.iframe||this.createIframe())}},{key:"processMessageQueue",value:function(){for(;this.messageQueue.length>0;){var t=this.messageQueue.shift();this.sendMessageToEmbed(t)}}},{key:"sendPromptToEmbed",value:function(t){this.sendMessageToEmbed({action:"PROMPT",content:t})}},{key:"showInternal",value:function(){this.iframe||this.createIframe(),this.iframeWrapper&&this.overlay&&!this.isVisible&&(this.iframeWrapper.classList.add("visible"),this.overlay.classList.add("visible"),this.isIframeReady||this.showLoadingOverlay(),this.isVisible=!0,localStorage.setItem(this.VISIBILITY_STORAGE_KEY,"true"),this.updateAllToggleElements(),this.hasBeenOpened||(this.hasBeenOpened=!0,this.createToggleButton(),this.toggleButton&&document.body.appendChild(this.toggleButton)),this.toggleButton&&this.toggleButton.classList.remove("visible"))}},{key:"hideInternal",value:function(){this.iframeWrapper&&this.overlay&&this.isVisible&&(this.iframeWrapper.classList.remove("visible"),this.overlay.classList.remove("visible"),this.hideLoadingOverlay(),this.isVisible=!1,localStorage.setItem(this.VISIBILITY_STORAGE_KEY,"false"),this.updateAllToggleElements(),this.hasBeenOpened&&this.toggleButton&&!this.showWidget&&this.toggleButton.classList.add("visible"))}},{key:"toggleInternal",value:function(){this.isVisible?this.hideInternal():this.showInternal(),this.updateAllToggleElements()}},{key:"updateAllToggleElements",value:function(){var t=this;document.querySelectorAll("[data-helper-toggle]").forEach((function(e){t.updateToggleState(e)}))}},{key:"destroyInternal",value:function(){this.iframeWrapper&&document.body.removeChild(this.iframeWrapper),this.overlay&&document.body.removeChild(this.overlay),this.toggleButton&&document.body.removeChild(this.toggleButton),this.notificationContainer&&document.body.removeChild(this.notificationContainer),this.hideAllNotifications(),this.observer&&this.observer.disconnect()}},{key:"createNotificationContainer",value:function(){this.notificationContainer||(this.notificationContainer=document.createElement("div"),this.notificationContainer.className="notification-container",this.showWidget&&this.notificationContainer.classList.add("with-widget"),document.body.appendChild(this.notificationContainer))}},{key:"createNotificationBubble",value:function(t){var e,n=document.createElement("div");n.className="notification-bubble",this.config.mailbox_slug===d&&n.classList.add("gumroad-theme");var i=document.createElement("div");i.className="message",n.appendChild(i);var o=document.createElement("button");return o.className="close-button",o.innerHTML='<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M2.5 2.5L9.5 9.5M2.5 9.5L9.5 2.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>',n.appendChild(o),null===(e=this.notificationContainer)||void 0===e||e.appendChild(n),n}},{key:"updateNotificationStatus",value:(s=l(i().mark((function t(e,n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("".concat(new URL("https://helper.ai/widget/embed").origin,"/api/widget/notification/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.sessionToken)},body:JSON.stringify({status:n})});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.error("Failed to update notification status:",t.t0);case 8:case"end":return t.stop()}}),t,this,[[0,5]])}))),function(t,e){return s.apply(this,arguments)})},{key:"showNotification",value:function(e,n,i){var o=this,r=this.notificationBubbles.get(n);r||(r=this.createNotificationBubble(n),this.notificationBubbles.set(n,r)),this.helperIcon&&this.helperIcon.classList.add("has-notification");var a=r.querySelector(".message");a&&(a.textContent=e),null==a||a.addEventListener("click",(function(){o.updateNotificationStatus(i,"read"),o.hideNotification(n),t.show(),o.sendMessageToEmbed({action:"OPEN_CONVERSATION",content:{conversationSlug:n}})}));var s=r.querySelector(".close-button");null==s||s.addEventListener("click",(function(t){t.stopPropagation(),o.updateNotificationStatus(i,"dismissed"),o.hideNotification(n)})),setTimeout((function(){r.classList.add("visible"),setTimeout((function(){o.hideNotification(n)}),5e3)}),100)}},{key:"hideNotification",value:function(t){var e=this,n=this.notificationBubbles.get(t);n&&(n.classList.remove("visible"),n.classList.add("hiding"),setTimeout((function(){n.remove(),e.notificationBubbles.delete(t),e.helperIcon&&0===e.notificationBubbles.size&&e.helperIcon.classList.remove("has-notification")}),300))}},{key:"hideAllNotifications",value:function(){var t=this;this.notificationBubbles.forEach((function(e,n){t.hideNotification(n)}))}}],a=[{key:"show",value:function(){t.instance&&t.instance.showInternal()}},{key:"hide",value:function(){t.instance&&t.instance.hideInternal()}},{key:"toggle",value:function(){t.instance&&t.instance.toggleInternal()}},{key:"sendPrompt",value:function(e){t.instance&&t.instance.sendPromptToEmbed(e)}},{key:"init",value:function(e){return t.instance||(t.instance=new t(e),t.instance.setup()),t.instance}},{key:"destroy",value:function(){t.instance&&(t.instance.destroyInternal(),t.instance=null)}}],n&&c(e.prototype,n),a&&c(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,a,s,h}();u(f,"instance",null);const p=f;return e.default})()));